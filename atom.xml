<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Haruka Ozaki / 尾崎 遼]]></title>
  <link href="http://yuifu.github.io/atom.xml" rel="self"/>
  <link href="http://yuifu.github.io/"/>
  <updated>2014-03-11T12:46:22+09:00</updated>
  <id>http://yuifu.github.io/</id>
  <author>
    <name><![CDATA[yuifu]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[ゲノムサイズのデータベース]]></title>
    <link href="http://yuifu.github.io/blog/2013/08/14/genome-size-database/"/>
    <updated>2013-08-14T08:44:00+09:00</updated>
    <id>http://yuifu.github.io/blog/2013/08/14/genome-size-database</id>
    <content type="html"><![CDATA[<h1>真核生物</h1>

<p>NARの2006年のDatabase Issueに<a href="http://nar.oxfordjournals.org/content/35/suppl_1/D332.long">Eukaryotic genome size databases</a>という論文があり，以下のデータベースを紹介していました．</p>

<p>全ゲノム配列によるものではなく，実験的な推定値です．</p>

<ul>
<li><a href="data.kew.org/cvalues/">Plant DNA C-values Database</a></li>
<li><a href="www.genomesize.com">Animal Genome Size Database</a></li>
<li><a href="www.zbi.ee/fungal-genomesize/">Fungal Genome Size Database</a></li>
</ul>


<h1>原核生物</h1>

<p>上記のAnimal Genome Size Databaseのサブページとしてありますが，2005年以降アップデートしていないようです．実験的な推定値と全ゲノム配列による値の両方が入っているようです．</p>

<ul>
<li><a href="http://www.genomesize.com/prokaryotes/">Prokaryote Genome Size Database</a></li>
</ul>


<p>このページに，全ゲノム配列によるものはこちらをみてほしいと書いてあったものが以下です．</p>

<ul>
<li><a href="http://cmr.jcvi.org/tigr-scripts/CMR/CmrHomePage.cgi">Comprehensive Microbial Resource</a></li>
<li><a href="http://www.genomesonline.org/cgi-bin/GOLD/index.cgi">GOLD (Genomes OnLine Database)</a></li>
<li><a href="http://www.cbs.dtu.dk/services/GenomeAtlas/">Genome Atlas</a></li>
</ul>


<h1>細胞サイズ</h1>

<p>上記のAnimal Genome Size Databaseのサブページとしてありますが，2005年以降アップデートしていないようです．</p>

<ul>
<li><a href="http://www.genomesize.com/cellsize/">Cell Size Database</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[pplacerの使い方]]></title>
    <link href="http://yuifu.github.io/blog/2013/08/06/pplacer-tutorial/"/>
    <updated>2013-08-06T18:12:00+09:00</updated>
    <id>http://yuifu.github.io/blog/2013/08/06/pplacer-tutorial</id>
    <content type="html"><![CDATA[<h1>pplacerとは</h1>

<p><a href="http://matsen.fhcrc.org/pplacer/"><code>pplacer</code></a>はメタゲノムデータ中にどのような種が多いかを可視化・比較するツールです．</p>

<p>メタゲノム中に含まれる遺伝子配列ひとつひとつについて，予め作成したリファレンス系統樹（16Sなどのuniversal geneの遺伝子系統樹）上のどこに配置（placement）するべきかを計算し，メタゲノムデータに含まれる種の構成を系統樹上の枝の太さに変換します．</p>

<hr />

<h1>全体の流れ</h1>

<p>矢印の先に使用するソフトウェアを書いてあります．</p>

<ol>
<li>必要なツールのインストール</li>
<li>あるオーソログについての配列を集める（リファレンス配列）</li>
<li>リファレンス配列からマルチプルアラインメントを計算する（リファレンスアラインメント） → MAFFTなど</li>
<li>マルチプルアラインメントから系統樹を推定する（リファレンス系統樹） → FastTreeまたはRAxML/phyml</li>
<li>上記で作られたファイルから，リファレンスパッケージを作成する → taxtastic</li>
<li>あるオーソログに類似した配列をメタゲノムデータから集める → BLAST, HMMER, Infernalなど</li>
<li>リファレンスアラインメントに対してメタゲノムのリードをアラインメントする → MAFFTなど</li>
<li>メタゲノムのリードをリファレンス系統樹へ配置（placement）する → pplacer</li>
<li>可視化，比較などを行う → guppy, Archaeopteryx</li>
</ol>


<h2>mothur/QIIMEユーザ向け情報</h2>

<p><a href="http://matsen.fhcrc.org/pplacer/2013/05/20/v1.1.alpha14.html">pplacerのアップデート報告</a>によると，<code>mothur</code>/<code>QIIME</code>のBIOM fileとtreeをリファレンスパッケージと<code>.jplace</code>ファイルの代わりに使えるそうです．</p>

<hr />

<h1>フォーマットの説明</h1>

<h2>リファレンスパッケージ（Reference package）の作成に必要なファイル</h2>

<ul>
<li><code>seqs.fa</code>: リファレンス配列のマルチプルアラインメント．FASTAフォーマット．</li>
<li><code>tree.nwk</code>: リファレンスアラインメントから作成された系統樹．Newickフォーマット．</li>
<li><code>tree_stat.txt</code>: FastTreeのログファイル，または，RAxML/phymlのstatisticsファイル．</li>
</ul>


<p>さらに，オプションで追加できるものがあります．詳しくは<a href="http://fhcrc.github.io/taxtastic/quickstart.html#taxonomically-equipped-reference-package-example">こちら</a>を参照してください．</p>

<ul>
<li><code>tax_ids.txt</code>: リファレンスアラインメントに含まれる配列のtaxon id のリスト．一行ごとにIDが書かれているテキストファイル．</li>
<li><code>seq_info.csv</code>: アラインメントされた配列に関するCSVファイル．
ヘッダーは<code>seqname</code>,<code>accession</code>,<code>tax_id</code>,<code>species_name</code>,<code>is_type</code>とする．一行ごとに，マルチプルアラインメントに含まれる配列について記述する．最低限，<code>seqname</code>,<code>tax_id</code>があればよい．</li>
</ul>


<h2>リファレンスパッケージ（Reference package）</h2>

<ul>
<li>リファレンスアラインメント，リファレンス系統樹，分類学的情報に関するファイルを集めたディレクトリ（*.refpkg）</li>
<li><a href="http://github.com/fhcrc/taxtastic"><code>taxtastic</code></a>を用いて作成する</li>
<li><a href="http://microbiome.fhcrc.org/apps/refpkg/">リファレンスパッケージの例</a></li>
</ul>


<h2>プレイスファイル（Place file）</h2>

<ul>
<li>リファレンス系統樹上へのリードの配置（placement）に関する情報</li>
<li>JSONフォーマット（*.jplace）</li>
</ul>


<hr />

<h1>必要なツールのインストール</h1>

<h2>MAFFTのインストール</h2>

<p><code>MAFFT</code>はマルチプルアラインメントを高速に行うツールです．</p>

<p><a href="http://mafft.cbrc.jp/alignment/software/">こちら</a>からダウンロードできます．</p>

<h2>FastTreeのインストール</h2>

<p><code>FastTree</code>はマルチプルアラインメントから系統樹を推定するツールです．</p>

<p><a href="http://meta.microbesonline.org/fasttree/#Install">Downloading and Installing FastTree</a>を参考にしてインストールしてください．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'># Macの場合
</span><span class='line'>gcc -O3 -finline-functions -funroll-loops -Wall -o FastTree FastTree.c -lm </span></code></pre></td></tr></table></div></figure>


<h2>taxtasticのインストール</h2>

<p><code>taxtastic</code>はリファレンスパッケージの作成するツールです．リファレンスパッケージは，リファレンス系統樹，リファレンスアラインメント，プロファイル，およびその他のメタデータから構成されるディレクトリです．</p>

<p><a href="https://github.com/fhcrc/taxtastic/blob/master/README.rst">taxtastic/README.rst</a>を参考にしてインストールしてください．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># easy_installによるインストール
</span><span class='line'>sudo easy_install taxtastic </span></code></pre></td></tr></table></div></figure>


<p></p>

<h2>pplacerのインストール</h2>

<p>LinuxまたはMax OSXに対応しています．<a href="http://matsen.fhcrc.org/pplacer/">こちらのページ</a>からバイナリファイルをダウンロードしてください．</p>

<p>ダウンロードした圧縮ファイルを解凍すると，ディレクトリに<code>guppy</code>，<code>pplacer</code>，<code>rppr</code>という3つのプログラムがあると思います．システムがそれらのプログラムを見つけられるように，このディレクトリにパスを通してください．</p>

<h2>Archaeopteryxのインストール</h2>

<p><code>Archaeopteryx</code>は系統樹の可視化ツールです．<a href="https://sites.google.com/site/cmzmasek/home/software/archaeopteryx">こちらのページ</a>から，<code>forester.jar</code>をダウンロードしてください．</p>

<p>また，<code>_aptx_configuration_file</code>というconfiguration fileを<a href="https://github.com/fhcrc/microbiome-demo/blob/master/bin/_aptx_configuration_file">こちらのページ</a>からダウンロードしてください．</p>

<hr />

<h1>リファレンスパッケージの作成まで</h1>

<h2>あるオーソログについての配列を集める</h2>

<p>16SrRNAの場合は<code>Infernal</code>などの二次構造を考慮した配列検索ツールを，タンパク質コード遺伝子であればBLASTやHMMERなどを利用することになると思います．ここでは詳しくは触れません．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ここではテストデータを作成します（50個のエントリを含むFASTAファイル）
</span><span class='line'>$ head -n 100 GreenGenesCore-May09.ref.fna &gt; seq.fa</span></code></pre></td></tr></table></div></figure>


<h2>リファレンス配列からマルチプルアラインメントを計算する</h2>

<p><code>MAFFT</code>でマルチプルアラインメントを計算します．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mafft --auto seq.fa &gt; seq_align.fa </span></code></pre></td></tr></table></div></figure>


<h2>マルチプルアラインメントから系統樹を推定する</h2>

<p><code>FastTree</code>で系統樹の推定します．この際，<code>-log</code>オプションでログファイルを出力します．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>FastTree -gtr -nt -log fasttree.log &lt; seq_align.fa &gt; tree.nwk</span></code></pre></td></tr></table></div></figure>


<h2>リファレンスパッケージの作成</h2>

<p><code>-l</code>オプションで任意の遺伝子名を表す名前を付けることができます．<code>-P</code>オプションで出力するリファレンスパッケージの名前を指定します．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># リファレンスパッケージの作成
</span><span class='line'>taxit create -l 16s_rRNA -P my.refpkg --aln-fasta seq_align.fa --tree-stats fasttree.log --tree-file tree.nwk
</span></code></pre></td></tr></table></div></figure>


<p>また， 以下のように，分類情報を含むリファレンスを作成することもできます．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># NCBI taxonomyのデータをtaxonomy.dbとしてダウンロードする
</span><span class='line'>taxit new_database -d taxonomy.db
</span><span class='line'>
</span><span class='line'># tax_ids.txtの作成
</span><span class='line'>awk '/&gt;/{sub(/&gt;/,""); print }' seq.fa &gt; tax_ids.txt
</span><span class='line'> 
</span><span class='line'># tax_ids.txtに含まれる全ての種についてminimum sub taxonomyを格納した taxa.csv を作成する
</span><span class='line'>taxit taxtable -d taxonomy.db -t tax_ids.txt -o taxa.csv 
</span><span class='line'>
</span><span class='line'># リファレンスパッケージの作成
</span><span class='line'>taxit create -l locus_name -P my.refpkg --taxonomy taxa.csv --aln-fasta seqs.fasta --seq-info seq_info.csv --tree-stats tree_stats.txt --tree-file tree.nwk
</span></code></pre></td></tr></table></div></figure>


<p>リファレンスパッケージの作成に必要なファイルのフォーマットについては，<a href="http://fhcrc.github.io/taxtastic/quickstart.html">taxtasticのQuickstart</a>を参照してください．</p>

<hr />

<h1>リファレンスパッケージを作成してから</h1>

<h2>あるオーソログに類似した配列をメタゲノムデータから集める</h2>

<p>BLAST, HMMER, Infernalなどを使って，抽出してください</p>

<h2>リファレンスアラインメントに対してメタゲノムのリードをアラインメントする</h2>

<p><code>-add</code>オプションで追加するメタゲノムのリードを指定します．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mafft --auto --add test.fa seq_align.fa &gt; test_align.fa</span></code></pre></td></tr></table></div></figure>


<p>また，リファレンス配列とメタゲノムデータ由来の配列を混ぜた（マージした）配列について，<code>MAFFT</code>を実行することも可能だと思います．</p>

<h2>メタゲノムのリードをリファレンス系統樹へ配置（placement）する</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Place file の作成（*.jplaceがつくられる）
</span><span class='line'>pplacer -c my.refpkg test_align.fa
</span></code></pre></td></tr></table></div></figure>


<h2>可視化</h2>

<p><code>guppy</code>で可視化のために使うphyloXMLフォーマットのファイルを作成します．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># phyloXMLフォーマットのファイルの作成（リファレンスパッケージに分類情報が含まれる場合）
</span><span class='line'>guppy fat -c vaginal_16s.refpkg p4z1r36.jplace
</span><span class='line'>
</span><span class='line'># phyloXMLフォーマットのファイルの作成（リファレンスパッケージに分類情報が含まれない場合）
</span><span class='line'>guppy fat test_align.jplace </span></code></pre></td></tr></table></div></figure>


<p>リファレンスパッケージに分類情報が含まれないときに，<code>guppy fat</code>の<code>-c</code>オプションでリファレンスパッケージを指定すると，以下のようなエラーが出ます．この場合は，<code>-c</code>オプションを使用しないとうまくいきます．しかし，可視化の際に分類情報は表示されません．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ guppy fat -c my.refpkg test_align.jplace 
</span><span class='line'>Uncaught exception: Refpkg.Missing_element("taxonomy")
</span><span class='line'>Fatal error: exception Refpkg.Missing_element("taxonomy")</span></code></pre></td></tr></table></div></figure>


<p>phyloXMLファイルができたら，<code>archaeopteryx</code>を実行します．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>java -jar forester.jar -c _aptx_configuration_file GreenGenesCore-May09.ref.align.xml
</span></code></pre></td></tr></table></div></figure>


<h2>比較</h2>

<p><code>guppy kr</code>は複数のplace file（.jplace）を比較し，サンプル間の距離行列を作成します．ここでの距離は，UniFracを一般化した，Kantorovich-Rubinstein (KR) metricです．KR metricは一つのplacement（リードの系統樹上での分布）から別のplacementに変換するのに要する移動の量と解釈できます．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># *.jplace はカレントディレクトリにある.jplaceファイルすべてを指定しています
</span><span class='line'>guppy kr *.jplace </span></code></pre></td></tr></table></div></figure>


<p><code>guppy kr_heat</code>で２つのplace file（.jplace）を比較した図を作成することができます．枝上の移動量に比例して，枝を太くなります（赤は根に向かう方向，青は葉に向かう方向の移動を表す）．つまり，２つのサンプル間で違いが大きい枝が太くなります．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>guppy kr_heat -c foo.refpkg bar1.jplace bar2.jplace
</span><span class='line'>java -jar forester.jar -c _aptx_configuration_file bar1.bar2.heat.xml &</span></code></pre></td></tr></table></div></figure>


<h2>Edge principal components analysis</h2>

<p><code>guppy pca</code>で，placementを特徴量としたPCAによりサンプル間比較ができます．詳しくは<a href="http://matsen.fhcrc.org/pplacer/demo/pca.html">こちら</a>を読んでください．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>guppy epca --prefix pca_out -c foo.refpkg *.jplace
</span><span class='line'>
</span><span class='line'>java -jar forester.jar -c _aptx_configuration_file pca_out.xml &</span></code></pre></td></tr></table></div></figure>


<p><code>pca_out.trans</code>にはPCAの軸へ射影されたサンプルの情報が含まれています．</p>

<h2>Squash clustering</h2>

<p><code>guppy squash</code>で，placementに特化したサンプルの階層的クラスタリングを行えます．<code>--out-dir</code>オプションで指定したディレクトリ内に<code>cluster.tre</code>というクラスタリングの樹形を格納したファイルを作成し，また，内部ノードごとの平均を格納した<code>mass_trees</code>というサブディレクトリを作成します．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>mkdir squash_out
</span><span class='line'>guppy squash -c foo.refpkg --out-dir squash_out *.jplace
</span><span class='line'>java -jar forester.jar -c _aptx_configuration_file squash_out/cluster.tre &</span></code></pre></td></tr></table></div></figure>


<p>クラスタリングの樹形図の6番という内部ノードについて可視化することができます．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>java -jar forester.jar -c _aptx_configuration_file squash_out/mass_trees/6.phy.fat.xml &</span></code></pre></td></tr></table></div></figure>


<h1>メタゲノムのリードの分類</h1>

<p><code>guppy classify</code>によって，メタゲノムのリードを分類できます．出力のカラムはread name, attempted rank for classification, actual rank for classification, taxonomic identifier, confidenceです．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>guppy classify --mrca-class -c foo.refpkg bar.jplace &gt; classify.txt</span></code></pre></td></tr></table></div></figure>


<p>リードの分類をSQlite3で閲覧することもできるそうです．詳しくは<a href="http://fhcrc.github.io/microbiome-demo/">pplacerのデモ</a>を読んでください．</p>

<hr />

<h1>デモ</h1>

<h2>テストデータの作成</h2>

<p>リファレンス配列は<a href="http://www.ddbj.nig.ac.jp/whatsnew/061215-j.html">DDBJの16S rDNA配列</a>から作成しました（<code>ref.fa</code>）．また，リファレンス配列の<code>taxon id</code>のリスト（<code>taxid.txt</code>），および，<code>ref.fa</code>での配列名と<code>taxon id</code>を紐付けるcsvファイル（<code>ref.csv</code>）を作成しました．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># リファレンス配列の準備（100エントリのFASTA）
</span><span class='line'>awk '{if(/&gt;/){n++}; if(n&gt;100){exit}; print}' 16S.seq &gt; ref.fa</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ head taxid.txt
</span><span class='line'>1334
</span><span class='line'>81436
</span><span class='line'>1318
</span><span class='line'>1596
</span><span class='line'>334344
</span><span class='line'>76637
</span><span class='line'>78164
</span><span class='line'>198312
</span><span class='line'>1520
</span><span class='line'>2743</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ head ref_info.csv
</span><span class='line'>"seqname","tax_id"
</span><span class='line'>"AB002492","1334"
</span><span class='line'>"AB003466","81436"
</span><span class='line'>"AB006127","1318"
</span><span class='line'>"AB008209","1596"
</span><span class='line'>"AB010844","334344"
</span><span class='line'>"AB012648","76637"
</span><span class='line'>"AB015608","78164"
</span><span class='line'>"AB017113","198312"
</span><span class='line'>"AB020191","1520"</span></code></pre></td></tr></table></div></figure>


<p>メタゲノムのリードは<a href="http://bmf2.colorado.edu/fastunifrac/tutorial.psp">FastUniFracのチュートリアル</a>にあったGreenGeneの16Sの配列から作成しました．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># メタゲノムのリードの準備（500エントリのFASTAファイル; 16S）
</span><span class='line'>awk '{if(/&gt;/){n++}; if(n&gt;500){exit}; print}' GreenGenesCore-May09.ref.fna &gt; seq1.fa
</span><span class='line'>awk 'NR&gt;1000{if(/&gt;/){n++}; if(n&gt;500){exit}; print}' GreenGenesCore-May09.ref.fna &gt; seq2.fa</span></code></pre></td></tr></table></div></figure>


<h2>本番</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># リファレンスアラインメントの計算
</span><span class='line'>mafft --auto ref.fa &gt; ref_align.fa  
</span><span class='line'>
</span><span class='line'># リファレンス系統樹の推定
</span><span class='line'>FastTree -gtr -nt -log fasttree.log &lt; ref_align.fa &gt; ref_tree.nwk 
</span><span class='line'>
</span><span class='line'># リファレンスパッケージの作成
</span><span class='line'>taxit new_database -d taxonomy.db 
</span><span class='line'>taxit taxtable -d taxonomy.db -t taxid.txt -o taxa.csv 
</span><span class='line'>taxit create -l 16s_rRNA -P my.refpkg --taxonomy taxa.csv --aln-fasta ref_align.fa --seq-info ref_info.csv --tree-stats fasttree.log --tree-file ref_tree.nwk 
</span><span class='line'>
</span><span class='line'># リファレンスアラインメントへのメタゲノムのリードのアラインメント
</span><span class='line'>mafft --auto --add seq1.fa ref_align.fa &gt; seq_align1.fa
</span><span class='line'>mafft --auto --add seq2.fa ref_align.fa &gt; seq_align2.fa
</span><span class='line'>
</span><span class='line'># Place file の作成（*.jplaceがつくられる）
</span><span class='line'>pplacer -c my.refpkg seq_align1.fa
</span><span class='line'>pplacer -c my.refpkg seq_align2.fa
</span><span class='line'>
</span><span class='line'># 可視化
</span><span class='line'>guppy fat -c my.refpkg seq_align1.jplace
</span><span class='line'>guppy fat -c my.refpkg seq_align2.jplace
</span><span class='line'>java -jar forester.jar -c _aptx_configuration_file seq_align1.xml &</span></code></pre></td></tr></table></div></figure>


<p>このように可視化されます．</p>

<p><img src="http://yuifu.github.io/images/pplacer_1.png"></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># サンプル間距離の計算
</span><span class='line'>guppy kr seq_align1.jplace seq_align2.jplace
</span><span class='line'>
</span><span class='line'># 2サンプル間比較
</span><span class='line'>guppy kr_heat -c my.refpkg seq_align1.jplace seq_align2.jplace
</span><span class='line'>
</span><span class='line'>java -jar bin/forester.jar -c _aptx_configuration_file seq_align1.seq_align2.heat.xml &</span></code></pre></td></tr></table></div></figure>


<p>このようになります．</p>

<p><img src="http://yuifu.github.io/images/pplacer_2.png"></p>

<p><img src="http://yuifu.github.io/images/pplacer_3.png"></p>

<hr />

<h1>補足</h1>

<h2>guppy (Grand Unified Phylogenetic Placement Yanalyzer)について</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># サブコマンドの一覧を表示
</span><span class='line'>guppy --cmd
</span><span class='line'>
</span><span class='line'># サブコマンドの実行（SUBCOMMANDの部分に使いたいサブコマンドを挿入する）
</span><span class='line'>guppy SUBCOMMAND [options] [files] 
</span><span class='line'>
</span><span class='line'># サブコマンドのヘルプ
</span><span class='line'>guppy SUBCOMMAND --help</span></code></pre></td></tr></table></div></figure>


<hr />

<h1>参考</h1>

<ul>
<li><a href="http://fhcrc.github.io/microbiome-demo/">pplacerのデモ</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[系統樹を描くのにClustalWを使うな]]></title>
    <link href="http://yuifu.github.io/blog/2013/08/06/do-not-use-clustal/"/>
    <updated>2013-08-06T10:50:00+09:00</updated>
    <id>http://yuifu.github.io/blog/2013/08/06/do-not-use-clustal</id>
    <content type="html"><![CDATA[<p><a href="http://betascience.blogspot.jp/2010/03/please-dont-use-clustal-for-tree.html">Beta Science: Please don&rsquo;t use Clustal for tree construction!</a>という短いブログ記事を見つけました．</p>

<p>まとめると，</p>

<ul>
<li>「Clustalで系統樹描きました」じゃなくて，どの方法で系統樹描いたかまで答えられるようにしといてほしい</li>
<li>そもそもClustalのインターフェースで提供されている系統樹推定手法（NJ法？）はそんなに良くない</li>
<li>もはや，より高速な<a href="http://www.drive5.com/muscle/">Muscle</a>などが出ているので，多くの人はマルチプルアラインメントにすらClustalを使わない</li>
<li>多くの人は系統樹推定に最尤法やベイズ法を用いた手法を使う（<a href="http://atgc.lirmm.fr/phyml/">PhyML</a>や<a href="http://mrbayes.sourceforge.net">Mr.Bayes</a>など）</li>
<li><a href="http://www.phylogeny.fr/">Robust Phylogenetic Analysis For The Non-Specialist</a>が参考になる</li>
</ul>


<p>また，<code>ClustalW</code>はguide treeという樹形図を計算の過程で構築しますが，これは系統樹ではありません．</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[cufflinks-library-norm-method]]></title>
    <link href="http://yuifu.github.io/blog/2013/07/25/cufflinks-library-norm-method/"/>
    <updated>2013-07-25T15:43:00+09:00</updated>
    <id>http://yuifu.github.io/blog/2013/07/25/cufflinks-library-norm-method</id>
    <content type="html"><![CDATA[<p>この記事では，CufflinksおよびCuffdiffの<code>--library-norm-method</code>オプションで指定できる，ライブラリサイズの正規化法の違いについて述べています．</p>

<h2>言葉の説明</h2>

<ul>
<li>ライブラリ library: サンプルのこと．</li>
<li>ライブラリサイズ library size: ライブラリのリード数のこと．Sequecning depthともいう．</li>
<li>size factor（scaling factor）: 各ライブラリのFPKMやフラグメントカウントを割るための値．
各ライブラリについて計算される値です．正規化因子とかスケーリング因子とか呼ばれたりします．<br/>
通常，他のライブラリに比べてFPKMやフラグメントカウントが大きいライブラリのスケーリング因子は，大きくなります．</li>
<li>フラグメント fragment: ペアエンドで読んだときの2つのreadを一組にした概念．</li>
</ul>


<blockquote><p>In paired-end RNA-Seq experiments, fragments are sequenced from both ends, providing two reads for each fragment.    <a href="http://cufflinks.cbcb.umd.edu/howitworks.html">Cufflinks RNA-Seq analysis tools &ndash; Background</a></p></blockquote>

<p>-FPKM: Fragments Per Kilobase of exon per Million fragments mapped (FPKM) のこと．
<a href="http://cufflinks.cbcb.umd.edu/howitworks.html#hqua">Cufflinks RNA-Seq analysis tools &ndash; Background</a>を参照のこと．</p>

<h2>library-norm-method</h2>

<p><code>classic-fpkm</code>，<code>geometric</code>，<code>quartile</code>の3種類があります．</p>

<h3>classic-fpkm</h3>

<ul>
<li>size factorは1．つまり，FPKMやフラグメントカウントに対してスケーリングを行わない</li>
<li>Cufflinksでのみ使用可能</li>
</ul>


<h3>geometric</h3>

<ul>
<li>まず，各遺伝子について，フラグメントカウントの全ライブラリについての幾何平均を求める．<br/>
次に，その幾何平均に対する各ライブラリでのフラグメントカウントの比を計算する．<br/>
最後に，その比の全遺伝子についてのメディアンを計算する．このメディアンをsize factorとして，FPKMとフラグメントカウントのスケーリングを行う．</li>
<li>幾何平均 geometric mean</li>
<li>Cuffdiffでのデフォルト</li>
<li><a href="http://genomebiology.com/2010/11/10/R106">Anders and Huber (Genome Biology, 2010)</a> を参照</li>
<li>DESeqで使われているのと同じもの</li>
</ul>


<script type="math/tex; mode=display">
\hat{s}_{j} = {\rm median}_{i} \frac{ k_{ij} } { \left (\prod_{v=1}^{m} k_{iv}  \right )^{1/m} }
</script>


<p><code>j</code>: ライブラリ(j=1,&hellip;,m)
<code>i</code>: 遺伝子
<code>k_{ij}</code>: ライブラリ<code>j</code>における遺伝子<code>i</code></p>

<h3>quartile</h3>

<ul>
<li>各ライブラリでのフラグメントカウントの第３四分位点の，全てのライブラリについての第３四分位点の平均値に対する比をsize factorとして，FPKMとフラグメントカウントのスケーリングを行う</li>
<li>いわゆるquantile normalization とは全く異なる</li>
</ul>


<script type="math/tex; mode=display">

\hat{s}_{j} =  \frac{ {\rm 3Q}_{i} (k_{ij}) } { \sum_{v=1}^{m} {\rm 3Q}_{i} (k_{iv}) }
</script>


<p><code>3Q_{i}</code>: k_{i,j} の全遺伝子についての分布から，第３四分位点を選ぶ関数だと思ってください．</p>

<h2>参考</h2>

<p><a href="http://cufflinks.cbcb.umd.edu/manual.html">Cufflinks RNA-Seq analysis tools &ndash; User&rsquo;s Manual</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SAM/BAMからマルチリードを除く方法]]></title>
    <link href="http://yuifu.github.io/blog/2013/07/19/remove-multi-reads/"/>
    <updated>2013-07-19T11:45:00+09:00</updated>
    <id>http://yuifu.github.io/blog/2013/07/19/remove-multi-reads</id>
    <content type="html"><![CDATA[<h2>マルチリードについて</h2>

<p>ゲノム上の複数箇所にマップされたリードをmultiple mapped reads, multi-reads, reads with multiple hits などと呼びます．
もしくは，一つのリードに対して複数のアラインメントが出力されるもの，とも言えます．</p>

<p>このマルチリードは，しばしば解析の前に除かれます．では，どうやって除いたらいいでしょうか．</p>

<h2>MAPQを使う</h2>

<p>MAPQ（SAM/BAMの５列目）が適切にセットされているなら，これを使うことができます．
適切というのは，ユニークなアラインメントでMAPQが50，アラインメントが２つだとMAPQが3，アラインメントが3以上だとMAPQが0に設定されている状態です．</p>

<p>このとき，<code>samtools view -q</code>を使って，以下のように書けます．</p>

<blockquote><p>-q INT      Skip alignments with MAPQ smaller than INT [0]</p></blockquote>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>samtools view -q 4 hoge.bam &gt; hoge.uniq.bam</span></code></pre></td></tr></table></div></figure>


<h2>NHを使う</h2>

<p>NHタグは，SAM/BAMファイルに，あるリードに対するアラインメントがいくつ入力されたかを <code>NH:i:[0-9]+</code>という形式で記録しています．</p>

<blockquote><p>NH      i      Number of reported alignments that contains the query in the current record</p></blockquote>

<p>（<a href="http://samtools.sourceforge.net/SAM1.pdf">The SAM Format Specification (PDF)</a>）</p>

<p>そのため，スクリプト言語で（私はNHの分布が知りたかったので，こちらの方法を使ってました）．
以下は，Perlで書いた例です．</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="nb">open</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="s">&quot;hoge.bam&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">open</span><span class="p">(</span><span class="n">O</span><span class="p">,</span> <span class="s">&quot;&gt; hoge.uniq.bam&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">while</span><span class="p">(</span><span class="sr">&lt;I&gt;</span><span class="p">){</span>
</span><span class='line'>     <span class="k">if</span><span class="p">(</span><span class="sr">/^@/</span><span class="p">){</span> <span class="c1"># header</span>
</span><span class='line'>          <span class="k">print</span> <span class="n">O</span> <span class="nv">$_</span><span class="p">;</span>
</span><span class='line'>          <span class="k">next</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'>     <span class="k">if</span><span class="p">(</span><span class="sr">/NH:i:([0-9]+)/</span><span class="p">){</span>  <span class="c1"># NH: Number of reported alignments that contains the query in the current record</span>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nv">$1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">){</span>
</span><span class='line'>               <span class="k">print</span> <span class="n">O</span> <span class="nv">$_</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nb">close</span><span class="p">(</span><span class="n">I</span><span class="p">);</span>
</span><span class='line'><span class="nb">close</span><span class="p">(</span><span class="n">O</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<h2>FLAGは使えなさそう</h2>

<p>掲示板などを読んでいるとFLAG（SAM/BAMの２列目）のビットを使って，すなわち<code>samtools view -F ***</code>を使う方法が提案されることがしばしばあります．
これはおそらく<code>0x100</code>(secondary alignment)のことを指しているのだと思うのですが，以下の例で示す通り，マルチヒットのリードを除くには不適切です．</p>

<p>=====</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="n">read1</span>      <span class="mi">339</span>     <span class="n">chr1</span>    <span class="mi">181938</span>  <span class="mi">3</span>       <span class="mi">2</span><span class="n">M107N99M</span>       <span class="o">=</span>       <span class="mi">181891</span>  <span class="o">-</span><span class="mi">255</span>    <span class="n">ACCGGAGGATGTTGGGATGGCAGAGGCGGTTCATGAGCTGCACCTCCCGCAGCATGTTGGCCTTGTTGCTCGCCAGCGTGTTCATCTTCAGCGCCATCACC</span>   <span class="n">BDDDCACCC</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="n">DDDDCDDDDDD</span><span class="nv">@@9BBCCDCC@49CCCCA</span><span class="o">&lt;</span><span class="n">DB</span><span class="p">?</span><span class="n">CDFFFFHHHHJJJJJIIJIJJJJJJJGJJJJIJJJJJJIJJJJHHHHHFFEDD</span><span class="p">?</span><span class="nv">@B</span>   <span class="n">AS:i:0</span>  <span class="n">XN:i:0</span>  <span class="n">XM:i:0</span>  <span class="n">XO:i:0</span>  <span class="n">XG:i:0</span>  <span class="n">NM:i:0</span>  <span class="n">MD:Z:101</span>        <span class="n">YT:Z:UU</span> <span class="n">XS:A:</span><span class="o">-</span>  <span class="n">NH:i:2</span>  <span class="n">CC:Z:</span><span class="o">=</span>  <span class="n">CP:i:182045</span>     <span class="n">HI:i:0:0</span>
</span><span class='line'><span class="n">read1</span>      <span class="mi">83</span>      <span class="n">chr1</span>    <span class="mi">182045</span>  <span class="mi">3</span>       <span class="mi">101</span><span class="n">M</span>    <span class="o">=</span>       <span class="mi">181891</span>  <span class="o">-</span><span class="mi">255</span>    <span class="n">ACCGGAGGATGTTGGGATGGCAGAGGCGGTTCATGAGCTGCACCTCCCGCAGCATGTTGGCCTTGTTGCTCGCCAGCGTGTTCATCTTCAGCGCCATCACC</span>   <span class="n">BDDDCACCC</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="n">DDDDCDDDDDD</span><span class="nv">@@9BBCCDCC@49CCCCA</span><span class="o">&lt;</span><span class="n">DB</span><span class="p">?</span><span class="n">CDFFFFHHHHJJJJJIIJIJJJJJJJGJJJJIJJJJJJIJJJJHHHHHFFEDD</span><span class="p">?</span><span class="nv">@B</span>   <span class="n">AS:i:0</span>  <span class="n">XN:i:0</span>  <span class="n">XM:i:0</span>  <span class="n">XO:i:0</span>  <span class="n">XG:i:0</span>  <span class="n">NM:i:0</span>  <span class="n">MD:Z:101</span>        <span class="n">YT:Z:UU</span> <span class="n">NH:i:2</span>  <span class="n">HI:i:11</span>
</span></code></pre></td></tr></table></div></figure>


<p>これは，ペアエンドのリードをTopHatでアラインメントして得られた，あるリード <code>read1</code>に対する2つのアラインメントです．
どちらも<code>NH:i:2</code>であることから，各リードに対して，ファイル中に2つのアラインメントが出力されていることがわかります．これは，MAPQ（５列目）が<code>3</code>になっていることからも分かります．
一方で，FLAG（２列目）が，read1では<code>339</code>（0x1, 0x2, 0x10, 0x40, 0x100）で，read2では<code>83</code>（0x1, 0x2, 0x10, 0x20）となっています．２つのアラインメントにEdit distanceなどで違いがないにも関わらず，片方だけに<code>0x100</code>が付いています．</p>

<p>つまり，マルチヒットのリードを除くという目的には不適切だと言えます．</p>

<h2>参考</h2>

<ul>
<li><a href="http://seqanswers.com/forums/showthread.php?t=19491">Remove reads which are not uniquely mapped &ndash; SEQanswers</a></li>
</ul>


<h2>（参考）FLAGのビットの意味</h2>

<p><a href="http://samtools.sourceforge.net/SAM1.pdf">The SAM Format Specification (PDF)</a></p>

<table>
<thead>
<tr>
<th></th>
<th align="left"> Bit </th>
<th align="right"> Description  </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td align="left"> 0x1 </td>
<td align="right"> template having multiple segments in sequencing |</td>
</tr>
<tr>
<td></td>
<td align="left"> 0x2 </td>
<td align="right"> each segment properly aligned according to the aligner |</td>
</tr>
<tr>
<td></td>
<td align="left"> 0x4 </td>
<td align="right"> segment unmapped |</td>
</tr>
<tr>
<td></td>
<td align="left"> 0x8 </td>
<td align="right"> next segment in the template unmapped |</td>
</tr>
<tr>
<td></td>
<td align="left"> 0x10 </td>
<td align="right"> SEQ being reverse complemented |</td>
</tr>
<tr>
<td></td>
<td align="left"> 0x20 </td>
<td align="right"> SEQ of the next segment in the template being reversed</td>
</tr>
<tr>
<td></td>
<td align="left"> 0x40 </td>
<td align="right"> the first segment in the template |</td>
</tr>
<tr>
<td></td>
<td align="left"> 0x80 </td>
<td align="right"> the last segment in the template |</td>
</tr>
<tr>
<td></td>
<td align="left"> 0x100 </td>
<td align="right"> secondary alignment |</td>
</tr>
<tr>
<td></td>
<td align="left"> 0x200 </td>
<td align="right"> not passing quality controls</td>
</tr>
<tr>
<td></td>
<td align="left"> 0x400 </td>
<td align="right"> PCR or optical duplicate |</td>
</tr>
</tbody>
</table>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[samtools rmdup の挙動に関する実験]]></title>
    <link href="http://yuifu.github.io/blog/2013/07/18/samtools-rmdup/"/>
    <updated>2013-07-18T21:02:00+09:00</updated>
    <id>http://yuifu.github.io/blog/2013/07/18/samtools-rmdup</id>
    <content type="html"><![CDATA[<h2>samtools rmdup について</h2>

<p><code>samtools rmdup</code>は，potential PCR duplicates を除くのによく使われる便利なツールです．</p>

<p><a href="http://samtools.sourceforge.net/samtools.shtml">samtoolsの公式</a>では以下のように説明してあります．</p>

<blockquote><p>samtools rmdup [-sS] &lt;input.srt.bam> &lt;out.bam></p>

<p>Remove potential PCR duplicates: if multiple read pairs have identical external coordinates, only retain the pair with highest mapping quality. In the paired-end mode, this command ONLY works with FR orientation and requires ISIZE is correctly set. It does not work for unpaired reads (e.g. two ends mapped to different chromosomes or orphan reads).</p>

<p>OPTIONS:</p>

<p>-s      Remove duplicate for single-end reads. By default, the command works for paired-end reads only.</p>

<p>-S      Treat paired-end reads and single-end reads.</p></blockquote>

<p>しかし，この説明ではオプションを使った場合にどのような挙動をするのかよくわからなかっため，簡単な実験を行いました．</p>

<h2>実験</h2>

<p>まず，座標が同一な，ペアエンドのリード（ペアの両方または片方のみがマップされているもの）およびシングルエンドのリードから成るテストデータを作成しました．
リード名はそれぞれ以下の通り．</p>

<ul>
<li>test_pe_* はペアエンドでかつ両方のセグメントがマップされているリード（0x1）を表す</li>
<li>test1_peu_* はペアの片方のセグメントのみがマップされているリード（0x1と0x8）を表す</li>
<li>test_se_* はシングルエンドのリードを表す</li>
<li>末尾の0と1は，互いに同じ座標の異なるリードであることを示す</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ samtools view test.bam
</span><span class='line'>test_pe_0     99     chr1     160502     50     101M     =     160543     142     TGGGCTTGCTCTGCTGGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACA     @@@FFFFFHHHGGHHJJIIJJIIJHIIIIJJJGHIJJJJJJJJIJHIJJJJJIJJJIGIJIJJIJIJJJIHHEBB==CBBBBBDDB&lt;BDDDDDD@BDDDD&gt;     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:92A2G5     YT:Z:UU     NH:i:1
</span><span class='line'>test_pe_1     99     chr1     160502     50     101M     =     160543     142     TGGGCTTGCTCTGCTGGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACA     @@@FFFFFHHHGGHHJJIIJJIIJHIIIIJJJGHIJJJJJJJJIJHIJJJJJIJJJIGIJIJJIJIJJJIHHEBB==CBBBBBDDB&lt;BDDDDDD@BDDDD&gt;     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:92A2G5     YT:Z:UU     NH:i:1
</span><span class='line'>test_se_0     0     chr1     160500     50     101M     *     0     0     GGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGC     @CCFFFFFGFHHHJJJJJJJJIJJJIJIJJJJJIJJJJJJJJJJJJJEHIHIJJJJJJIJJHHHHHHFDDDBDDDDDDD&gt;BDBDDDDDDDDDDDDDDDDDD     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:77A2G20     YT:Z:UU     NH:i:1
</span><span class='line'>test_se_1     0     chr1     160500     50     101M     *     0     0     GGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGC     @CCFFFFFGFHHHJJJJJJJJIJJJIJIJJJJJIJJJJJJJJJJJJJEHIHIJJJJJJIJJHHHHHHFDDDBDDDDDDD&gt;BDBDDDDDDDDDDDDDDDDDD     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:77A2G20     YT:Z:UU     NH:i:1
</span><span class='line'>test1_peu_0     137     chr1     160517     50     101M     *     0     0     GGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGC     @CCFFFFFGFHHHJJJJJJJJIJJJIJIJJJJJIJJJJJJJJJJJJJEHIHIJJJJJJIJJHHHHHHFDDDBDDDDDDD&gt;BDBDDDDDDDDDDDDDDDDDD     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:77A2G20     YT:Z:UU     NH:i:1
</span><span class='line'>test1_peu_1     137     chr1     160517     50     101M     *     0     0     GGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGC     @CCFFFFFGFHHHJJJJJJJJIJJJIJIJJJJJIJJJJJJJJJJJJJEHIHIJJJJJJIJJHHHHHHFDDDBDDDDDDD&gt;BDBDDDDDDDDDDDDDDDDDD     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:77A2G20     YT:Z:UU     NH:i:1
</span><span class='line'>test_pe_0     147     chr1     160543     50     101M     =     160502     -142     TCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGCCAGTTGATTGACAGCTCAACTGGTTG     &gt;CBBBDDBDDDDBA?CDDDEEDDDDDDDBBBDDBDDDDDDDFFHHFGGHDBJJIIHGIJIIHGGEGIIJJJJIGEIJJIJIJJJIHIJHHGDHDFFFD@C@     AS:i:-12     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:51A2G46     YT:Z:UU     NH:i:1
</span><span class='line'>test_pe_1     147     chr1     160543     50     101M     =     160502     -142     TCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGCCAGTTGATTGACAGCTCAACTGGTTG     &gt;CBBBDDBDDDDBA?CDDDEEDDDDDDDBBBDDBDDDDDDDFFHHFGGHDBJJIIHGIJIIHGGEGIIJJJJIGEIJJIJIJJJIHIJHHGDHDFFFD@C@     AS:i:-12     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:51A2G46     YT:Z:UU     NH:i:1</span></code></pre></td></tr></table></div></figure>


<p>このテストデータに対して<code>samtools rmdup</code>を実行します．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ samtools rmdup test.bam test_rmdup.bam
</span><span class='line'>$ samtools rmdup -s test.bam test_rmdup_s.bam
</span><span class='line'>$ samtools rmdup -S test.bam test_rmdup_S.bam</span></code></pre></td></tr></table></div></figure>


<p>結果を見てみます．ここではSAM/BAMの１列目のリード名（QNAME）のみを出力しています．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># test.bam
</span><span class='line'>$ samtools view test.bam |awk '{print $1}'
</span><span class='line'>test_pe_0
</span><span class='line'>test_pe_1
</span><span class='line'>test_se_0
</span><span class='line'>test_se_1
</span><span class='line'>test1_peu_0
</span><span class='line'>test1_peu_1
</span><span class='line'>test_pe_0
</span><span class='line'>test_pe_1
</span><span class='line'>
</span><span class='line'># samtools rmdup したもの
</span><span class='line'>$ samtools view test_rmdup.bam |awk '{print $1}'
</span><span class='line'>test_pe_0
</span><span class='line'>test_se_0
</span><span class='line'>test_se_1
</span><span class='line'>test1_peu_0
</span><span class='line'>test1_peu_1
</span><span class='line'>test_pe_0
</span><span class='line'>
</span><span class='line'># samtools rmdup -s したもの
</span><span class='line'>$ samtools view test_rmdup_s.bam |awk '{print $1}'
</span><span class='line'>test_pe_0
</span><span class='line'>test_pe_1
</span><span class='line'>test_se_0
</span><span class='line'>test1_peu_0
</span><span class='line'>test1_peu_1
</span><span class='line'>test_pe_0
</span><span class='line'>test_pe_1
</span><span class='line'>
</span><span class='line'># samtools rmdup -S したもの
</span><span class='line'>$ samtools view test_rmdup_S.bam |awk '{print $1}'
</span><span class='line'>test_pe_0
</span><span class='line'>test_se_0
</span><span class='line'>test1_peu_0
</span><span class='line'>test_pe_0</span></code></pre></td></tr></table></div></figure>


<p>これらの結果から，</p>

<ul>
<li>ペアの両方のセグメントがマップされている場合（0x1），デフォルトのときと<code>-S</code>がついているとき除かれる．</li>
<li>ペアの片方のセグメントのみがマップされている場合（0x1と0x8），<code>-S</code>がついているとき除かれる</li>
<li>シングルエンドの場合，<code>-s</code>もしくは<code>-S</code>がついているとき除かれる</li>
</ul>


<p>ということが分かりました．</p>

<h2>なにが挙動を決めているのか</h2>

<p>ペアの片方のセグメントのみがマップされている場合に，デフォルトでは除かれないことがわかりました．最初は，FLAG列をみてペアエンドかどうかを判定していると思い込んでいたので驚きました．</p>

<p>テストデータの<code>test_pe_*</code>と<code>test1_peu_*</code>を眺めていると，後者では７列目が<code>*</code>となっていました（それまで気付いていませんでした…）．
SAM/BAMの7列目のRNEXTは<a href="http://samtools.sourceforge.net/SAM1.pdf">The SAM Format Specification (PDF)</a>によると，以下のような説明がなされています．</p>

<blockquote><p>If RNEXT is ‘*’, no assumptions can be made on PNEXT and bit 0x20.</p></blockquote>

<p>この記述から，rmdupは RNEXTとPNEXTのみを参照しているように思えたのでさらに実験しました．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ samtools view test2.bam
</span><span class='line'>test_pe_0     99     chr1     160502     50     101M     *     0     0     TGGGCTTGCTCTGCTGGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACA     @@@FFFFFHHHGGHHJJIIJJIIJHIIIIJJJGHIJJJJJJJJIJHIJJJJJIJJJIGIJIJJIJIJJJIHHEBB==CBBBBBDDB&lt;BDDDDDD@BDDDD&gt;     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:92A2G5     YT:Z:UU     NH:i:1
</span><span class='line'>test_pe_1     99     chr1     160502     50     101M     *     0     0     TGGGCTTGCTCTGCTGGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACA     @@@FFFFFHHHGGHHJJIIJJIIJHIIIIJJJGHIJJJJJJJJIJHIJJJJJIJJJIGIJIJJIJIJJJIHHEBB==CBBBBBDDB&lt;BDDDDDD@BDDDD&gt;     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:92A2G5     YT:Z:UU     NH:i:1
</span><span class='line'>test_se_0     0     chr1     160500     50     101M     *     0     0     GGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGC     @CCFFFFFGFHHHJJJJJJJJIJJJIJIJJJJJIJJJJJJJJJJJJJEHIHIJJJJJJIJJHHHHHHFDDDBDDDDDDD&gt;BDBDDDDDDDDDDDDDDDDDD     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:77A2G20     YT:Z:UU     NH:i:1
</span><span class='line'>test_se_1     0     chr1     160500     50     101M     *     0     0     GGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGC     @CCFFFFFGFHHHJJJJJJJJIJJJIJIJJJJJIJJJJJJJJJJJJJEHIHIJJJJJJIJJHHHHHHFDDDBDDDDDDD&gt;BDBDDDDDDDDDDDDDDDDDD     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:77A2G20     YT:Z:UU     NH:i:1
</span><span class='line'>test1_peu_0     137     chr1     160517     50     101M     *     0     0     GGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGC     @CCFFFFFGFHHHJJJJJJJJIJJJIJIJJJJJIJJJJJJJJJJJJJEHIHIJJJJJJIJJHHHHHHFDDDBDDDDDDD&gt;BDBDDDDDDDDDDDDDDDDDD     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:77A2G20     YT:Z:UU     NH:i:1
</span><span class='line'>test1_peu_1     137     chr1     160517     50     101M     *     0     0     GGAATGGAGATTTCGCTCTCAGCTTCTCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGC     @CCFFFFFGFHHHJJJJJJJJIJJJIJIJJJJJIJJJJJJJJJJJJJEHIHIJJJJJJIJJHHHHHHFDDDBDDDDDDD&gt;BDBDDDDDDDDDDDDDDDDDD     AS:i:-10     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:77A2G20     YT:Z:UU     NH:i:1
</span><span class='line'>test_pe_0     147     chr1     160543     50     101M     *     0     0     TCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGCCAGTTGATTGACAGCTCAACTGGTTG     &gt;CBBBDDBDDDDBA?CDDDEEDDDDDDDBBBDDBDDDDDDDFFHHFGGHDBJJIIHGIJIIHGGEGIIJJJJIGEIJJIJIJJJIHIJHHGDHDFFFD@C@     AS:i:-12     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:51A2G46     YT:Z:UU     NH:i:1
</span><span class='line'>test_pe_1     147     chr1     160543     50     101M     *     0     0     TCTGTCTGCCTCCTCTTCTCTGATATCGGTCCGAGTCGTGCGCCGTAAGGGGGTCGAACAGCTCTCCAGCGCAGCCAGTTGATTGACAGCTCAACTGGTTG     &gt;CBBBDDBDDDDBA?CDDDEEDDDDDDDBBBDDBDDDDDDDFFHHFGGHDBJJIIHGIJIIHGGEGIIJJJJIGEIJJIJIJJJIHIJHHGDHDFFFD@C@     AS:i:-12     XN:i:0     XM:i:2     XO:i:0     XG:i:0     NM:i:2     MD:Z:51A2G46     YT:Z:UU     NH:i:1</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>samtools rmdup test2.bam test_rmdup2.bam
</span><span class='line'>samtools rmdup -s test2.bam test_rmdup_s2.bam
</span><span class='line'>samtools rmdup -S test2.bam test_rmdup_S2.bam</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># test2.bam
</span><span class='line'>$ samtools view test2.bam |awk '{print $1}'
</span><span class='line'>test_pe_0
</span><span class='line'>test_pe_1
</span><span class='line'>test_se_0
</span><span class='line'>test_se_1
</span><span class='line'>test1_peu_0
</span><span class='line'>test1_peu_1
</span><span class='line'>test_pe_0
</span><span class='line'>test_pe_1
</span><span class='line'>
</span><span class='line'># samtools rmdup したとき
</span><span class='line'>$ samtools view test_2.bam |awk '{print $1}'
</span><span class='line'>test_pe_0
</span><span class='line'>test_pe_1
</span><span class='line'>test_se_0
</span><span class='line'>test_se_1
</span><span class='line'>test1_peu_0
</span><span class='line'>test1_peu_1
</span><span class='line'>test_pe_0
</span><span class='line'>test_pe_1
</span><span class='line'>
</span><span class='line'># samtools rmdup -s したとき
</span><span class='line'>$ samtools view test__s2.bam |awk '{print $1}'
</span><span class='line'>test_pe_0
</span><span class='line'>test_pe_1
</span><span class='line'>test_se_0
</span><span class='line'>test1_peu_0
</span><span class='line'>test1_peu_1
</span><span class='line'>test_pe_0
</span><span class='line'>test_pe_1
</span><span class='line'>
</span><span class='line'># samtools rmdup -S したとき
</span><span class='line'>$ samtools view test__S2.bam |awk '{print $1}'
</span><span class='line'>test_pe_0
</span><span class='line'>test_se_0
</span><span class='line'>test1_peu_0
</span><span class='line'>test_pe_0</span></code></pre></td></tr></table></div></figure>


<p>今度は，デフォルトのときでも，ペアの両方のセグメントがマップされているリードが除かれなくなりました．
このことから，ペアエンドのリードを除くかどうかの判定には，（FLAGは関係なく）RNEXTおよびPNEXTのみを参照していると考えられました．
一方で，<code>-s</code>のときに，ペアの片方のみマップされたリードが除かれないことから，シングルエンドの判定にはFLAGを使っていると考えられます．</p>

<h2>まとめ</h2>

<ul>
<li>デフォルト: ペアエンドでペアの両方がマップされるものについて，PCR duplicatesかどうかを判定する</li>
<li><code>-s</code>: FLAGで0x1 (template having multiple segments in sequencing) がセットされていないリードについて，PCR duplicatesかどうかを判定する</li>
<li><code>-S</code>: すべてのリードをシングルエンドとして，PCR duplicatesかどうかを判定する</li>
</ul>


<p>余談ですが，<a href="http://samtools.sourceforge.net/samtools.shtml">samtoolsの公式</a>には</p>

<blockquote><p>-S      Treat paired-end reads and single-end reads.</p></blockquote>

<p>と書いてある一方で，例えば<a href="https://wikis.utexas.edu/display/bioiteam/Removing+duplicates+from+alignment+output">こちらのページ</a>には</p>

<blockquote><p>-S      Treat paired-end reads as single-end reads.</p></blockquote>

<p>と書いてあり，この書き方の方が分かりやすい気がしました．</p>

<p>もし勘違いなどあれば，コメントか<a href="https://twitter.com/yuifu">twitter</a>でご指摘いただけると幸いです．</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Octopressの準備]]></title>
    <link href="http://yuifu.github.io/blog/2013/07/17/setup-of-octopress/"/>
    <updated>2013-07-17T17:10:00+09:00</updated>
    <id>http://yuifu.github.io/blog/2013/07/17/setup-of-octopress</id>
    <content type="html"><![CDATA[<h2>git, ruby, octopress などのインストール</h2>

<p><a href="http://onigra.github.io/blog/2013/04/28/introduction-of-octopress/">こちらのブログ</a>を参考にしました．</p>

<h2>Github User/Organization pages</h2>

<p><a href="http://octopress.org/docs/deploying/github/">Octopressのページ</a> を参考にしました．
基本的にはこの通りにやればよいとのですが，githubのレポジトリを作成する際に <code>username.github.com</code> ではなく <code>username.github.io</code> にするようにするとうまくいきました．</p>

<h2>新しいポストの作成</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake new_post['test']
</span><span class='line'>rake generate
</span><span class='line'>rake deploy</span></code></pre></td></tr></table></div></figure>


<h2>新しいページの作成</h2>

<p><a href="http://onigra.github.io/blog/2013/04/28/introduction-of-octopress/">こちらのブログ</a>を参考にしました．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake new_page['about'] </span></code></pre></td></tr></table></div></figure>


<p><code>source/about/index.markdown</code> を編集して内容を追加する．
<code>source/_includes/custom/navigation.html</code> を編集して，ナビゲーションにリンクを追加する</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake generate
</span><span class='line'>rake deploy</span></code></pre></td></tr></table></div></figure>


<h2>デフォルトとは異なるテーマのインストール（オプション）</h2>

<p><a href="http://onigra.github.io/blog/2013/04/28/introduction-of-octopress/">こちらのブログ</a>を参考にしました．</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/lucaslew/whitespace.git .themes/whitespace
</span><span class='line'>rake install['whitespace']</span></code></pre></td></tr></table></div></figure>


<h2>途中で内容をプレビューしたいとき</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git generate
</span><span class='line'>git preview</span></code></pre></td></tr></table></div></figure>


<h2>tex プラグインのインストール</h2>

<p><a href="http://www.mk-mode.com/octopress/2013/01/03/octopress-display-tex-formula/">こちらのブログ</a>を参考にしました．</p>

<h2>TODO</h2>

<ul>
<li>Rが，自分のローカルにあるpygmentでは対応していないので，対応できるようにする．</li>
</ul>

]]></content>
  </entry>
  
</feed>
